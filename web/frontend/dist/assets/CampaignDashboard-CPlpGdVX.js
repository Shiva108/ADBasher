var e=(e,s,t)=>new Promise((a,l)=>{var n=e=>{try{i(t.next(e))}catch(s){l(s)}},r=e=>{try{i(t.throw(e))}catch(s){l(s)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,r);i((t=t.apply(e,s)).next())});import{j as s}from"./index-BoGeUeBd.js";import{c as t,r as a}from"./router-ld5oCHAN.js";import{a as l}from"./api-Do7PkaxD.js";import{l as n}from"./websocket-CUkmNz_4.js";import{s as r,b as i,c}from"./toast-6pFlHTyQ.js";import{e as d,f as o,C as x,g as m,h as p,D as h,c as u,K as b,i as j,T as g,j as f,k as v,z as N}from"./ui-jJASe3J9.js";import"./react-vendor-BhyxaAfg.js";const w=window.location.origin;function y({currentPage:e,totalPages:t,onPageChange:a}){return t<=1?null:s.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-6",children:[s.jsx("button",{onClick:()=>a(e-1),disabled:1===e,className:"p-2 rounded-md bg-slate-700 text-white hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s.jsx(d,{className:"h-5 w-5"})}),(()=>{const s=[];for(let a=Math.max(2,e-2);a<=Math.min(t-1,e+2);a++)s.push(a);return e-2>2&&s.unshift("..."),e+2<t-1&&s.push("..."),s.unshift(1),t>1&&s.push(t),s})().map((t,l)=>"..."===t?s.jsx("span",{className:"px-3 py-2 text-slate-400",children:"..."},`ellipsis-${l}`):s.jsx("button",{onClick:()=>a(t),className:"px-4 py-2 rounded-md font-medium transition-colors "+(e===t?"bg-emerald-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:t},t)),s.jsx("button",{onClick:()=>a(e+1),disabled:e===t,className:"p-2 rounded-md bg-slate-700 text-white hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s.jsx(o,{className:"h-5 w-5"})})]})}function C(){var d,o,C;const{campaignId:k}=t(),[S,L]=a.useState(null),[$,_]=a.useState([]),[P,R]=a.useState(null),[M,E]=a.useState(!0),[A,F]=a.useState(1),[T,z]=a.useState("all"),[D,O]=a.useState("");a.useEffect(()=>{U(),I();const e=n(w);return e.on("connect",()=>{e.emit("subscribe_campaign",{campaign_id:k})}),e.on("campaign_update",e=>{L(e)}),e.on("new_finding",e=>{_(s=>[e,...s])}),R(e),()=>{e&&(e.emit("unsubscribe_campaign",{campaign_id:k}),e.disconnect())}},[k]);const U=()=>e(null,null,function*(){try{const e=yield l.get(`/campaigns/${k}`);L(e),E(!1)}catch(e){r("Failed to fetch campaign: "+e.message),E(!1)}}),I=()=>e(null,null,function*(){try{const e=yield l.get(`/campaigns/${k}/findings`);_(e.findings)}catch(e){r("Failed to fetch findings: "+e.message)}}),V=e=>{switch(null==e?void 0:e.toLowerCase()){case"critical":return"text-red-500 bg-red-900/20 border-red-700";case"high":return"text-orange-500 bg-orange-900/20 border-orange-700";case"medium":return"text-amber-500 bg-amber-900/20 border-amber-700";default:return"text-blue-500 bg-blue-900/20 border-blue-700"}},G=(()=>{let e=$;if("all"!==T&&(e=e.filter(e=>{var s;return(null==(s=e.severity)?void 0:s.toLowerCase())===T})),D.trim()){const s=D.toLowerCase();e=e.filter(e=>{var t,a;return(null==(t=e.title)?void 0:t.toLowerCase().includes(s))||(null==(a=e.type)?void 0:a.toLowerCase().includes(s))||JSON.stringify(e.details).toLowerCase().includes(s)})}return e})(),H=Math.ceil(G.length/10),J=G.slice(10*(A-1),10*A);if(a.useEffect(()=>{F(1)},[T,D]),M)return s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"}),s.jsx("p",{className:"mt-4 text-slate-400",children:"Loading campaign..."})]})});if(!S)return s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:s.jsx("div",{className:"text-center text-red-400",children:"Campaign not found"})});const K=[{name:"Reconnaissance",key:"Reconnaissance"},{name:"Cred Attacks",key:"Credential Attacks"},{name:"Post-Exploit",key:"Post-Exploitation"},{name:"Lateral Movement",key:"Lateral Movement"},{name:"Reporting",key:"Generating Report"}];return s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[s.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:S.name}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-slate-400",children:[s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(x,{className:"h-4 w-4"}),s.jsx("span",{children:(q=S.elapsed_seconds,`${Math.floor(q/3600)}h ${Math.floor(q%3600/60)}m ${Math.floor(q%60)}s`)})]}),s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(m,{className:"h-4 w-4"}),s.jsx("span",{className:"capitalize",children:S.status})]})]})]}),s.jsxs("div",{className:"flex space-x-3",children:["running"===S.status&&s.jsxs("button",{onClick:()=>e(null,null,function*(){N(t=>s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold mb-2",children:"Stop this campaign?"}),s.jsx("p",{className:"text-sm text-slate-300 mb-3",children:"This will gracefully stop all running attacks."}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>e(null,null,function*(){N.dismiss(t.id);try{yield l.post(`/campaigns/${k}/stop`),i("Campaign stopped successfully"),U()}catch(e){r("Failed to stop campaign: "+e.message)}}),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Stop"}),s.jsx("button",{onClick:()=>N.dismiss(t.id),className:"px-3 py-1 bg-slate-600 hover:bg-slate-700 text-white rounded text-sm",children:"Cancel"})]})]}),{duration:5e3,style:{background:"#1e293b",color:"#e2e8f0",border:"1px solid #475569"}})}),className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors",children:[s.jsx(p,{className:"h-4 w-4"}),s.jsx("span",{children:"Stop"})]}),s.jsxs("button",{onClick:()=>e(null,null,function*(){try{const e=yield fetch(`/api/campaigns/${k}/report`);if(!e.ok)throw new Error("Report not available");const s=yield e.blob(),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.setAttribute("download",`adbasher_report_${k}.md`),document.body.appendChild(a),a.click(),a.remove(),i("Report downloaded successfully")}catch(e){c("Report not yet available")}}),className:"flex items-center space-x-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md transition-colors",children:[s.jsx(h,{className:"h-4 w-4"}),s.jsx("span",{children:"Report"})]})]})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700 mb-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("span",{className:"text-lg font-semibold text-white",children:S.current_phase}),s.jsxs("span",{className:"text-2xl font-bold text-emerald-500",children:[S.progress,"%"]})]}),s.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-4",children:s.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-400 h-3 rounded-full transition-all duration-500",style:{width:`${S.progress}%`}})}),s.jsx("div",{className:"flex justify-between",children:K.map((e,t)=>{const a=(l=e.key,S.current_phase===l?"current":S.progress>20*K.findIndex(e=>e.key===l)?"complete":"pending");var l;return s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-3 h-3 rounded-full mb-1 "+("complete"===a?"bg-emerald-500":"current"===a?"bg-blue-500 animate-pulse":"bg-slate-600")}),s.jsx("span",{className:"text-xs text-slate-400",children:e.name})]},t)})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsx("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Targets Discovered"}),s.jsx("p",{className:"text-3xl font-bold text-white",children:(null==(d=S.statistics)?void 0:d.targets)||0})]}),s.jsx(u,{className:"h-12 w-12 text-slate-600"})]})}),s.jsx("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Credentials Found"}),s.jsx("p",{className:"text-3xl font-bold text-emerald-500",children:(null==(o=S.statistics)?void 0:o.credentials)||0})]}),s.jsx(b,{className:"h-12 w-12 text-emerald-600"})]})}),s.jsx("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Vulnerabilities"}),s.jsx("p",{className:"text-3xl font-bold text-amber-500",children:(null==(C=S.statistics)?void 0:C.vulnerabilities)||0})]}),s.jsx(j,{className:"h-12 w-12 text-amber-600"})]})})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-slate-700",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("h2",{className:"text-xl font-semibold text-white flex items-center space-x-2",children:[s.jsx(g,{className:"h-5 w-5"}),s.jsxs("span",{children:["Findings (",G.length,")"]}),"running"===S.status&&s.jsx("span",{className:"text-xs text-slate-400",children:"(Auto-refresh)"})]})}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Search findings...",value:D,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-emerald-500"})]}),s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none"}),s.jsxs("select",{value:T,onChange:e=>z(e.target.value),className:"pl-10 pr-8 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:border-emerald-500 appearance-none cursor-pointer",children:[s.jsx("option",{value:"all",children:"All Severity"}),s.jsx("option",{value:"critical",children:"Critical"}),s.jsx("option",{value:"high",children:"High"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"low",children:"Low"})]})]})]})]}),s.jsx("div",{className:"divide-y divide-slate-700",children:0===J.length?s.jsxs("div",{className:"p-12 text-center text-slate-500",children:[s.jsx(g,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:0===$.length?"No findings yet. Campaign is in progress...":"No findings match your filters."})]}):J.map((e,t)=>{var a;return s.jsxs("div",{className:"p-6 hover:bg-slate-750 transition-colors",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${V(e.severity)}`,children:null==(a=e.severity)?void 0:a.toUpperCase()}),s.jsx("span",{className:"text-xs text-slate-500",children:"credential"===e.type?"ðŸ”‘ Credential":"ðŸš¨ Vulnerability"})]}),e.timestamp&&s.jsx("span",{className:"text-xs text-slate-500",children:new Date(e.timestamp).toLocaleTimeString()})]}),s.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:e.title}),e.details&&s.jsx("div",{className:"space-y-1 text-sm",children:Object.entries(e.details).map(([e,t])=>t?s.jsxs("div",{className:"flex",children:[s.jsxs("span",{className:"text-slate-400 w-32 capitalize",children:[e,":"]}),s.jsx("span",{className:"text-white font-mono",children:String(t)})]},e):null)})]},t)})}),H>1&&s.jsx("div",{className:"px-6 py-4 border-t border-slate-700",children:s.jsx(y,{currentPage:A,totalPages:H,onPageChange:F})})]})]});var q}export{C as default};
